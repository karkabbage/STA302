---
title: "STA302 Project"
author: "Karyna Lim"
date: "2024-06-17"
output: pdf_document
---

# Part1: Data exploration 

regres residuals to prediect weights, weights to correct shift in residuals, reduce effect of random error, similar dispersion, 

reduced preidction interval menas smaller variance if after transformation, wls corrects variance, 
solving covriance problem

pval: keep all params to zero, evidence that putting all to zero could provide a better fit, 

boxcox to see which power to use, check closest

We read our example data

```{r}
#install these and uncomment if u didn't download them yet:
#install.packages("ggfortify")
#install.packages("dplyr")
#install.packages("ggplot2")

set.seed(1101119291)

library(dplyr)
library(ggfortify)

n = 90 # number of samples

data_raw = read.csv("real_estate_final.csv")

# filtering to ensure continuous data, no jumps
data_raw <- data_raw %>% filter(MEDV <=40)
data_raw <- data_raw %>% filter(CRIM <=27)

sampled_df <- data_raw[sample(nrow(data_raw), n), ]

df_selected <- sampled_df %>% select(CRIM,NOX,RM, MEDV,LSTAT,DIS)#,TAX,PTRATIO,B,LSTAT,MEDV)

df_selected <- df_selected %>%mutate(DIS = sqrt(DIS))

df_selected <- df_selected %>% mutate(NOX = sqrt(NOX))

df_selected <- df_selected %>% mutate(CRIM = log(sqrt(CRIM)))

df_selected <- df_selected %>% mutate(RM = sqrt(RM))

df_selected["RM"] <- lapply(df_selected["RM"], function(x) (1 / x))

#df_selected["DIS"] <- lapply(df_selected["DIS"], function(x) (1 / x**2))
#df_selected["DIS"] <- lapply(df_selected["DIS"], log)
#df_selected["DIS"] <- lapply(df_selected["DIS"], function(x) (-x**2 - 4))

df_selected["LSTAT"] <- lapply(df_selected["LSTAT"], sqrt)

#CRIM,ZN,INDUS,CHAS,NOX,RM,AGE,DIS,RAD,TAX,PTRATIO,B,LSTAT,MEDV

# this plots each pair of variables against eachother to make sure they have a linear relation
pairs( df_selected, panel=function(x,y){
  points(x,y)
  abline(lm(y~x), col='red')
  text(0,1.5,labels = paste('R2=',round((cor(x,y))^2,2)) ,col='red' )
})

model <- lm(MEDV ~ CRIM + NOX + LSTAT + DIS, data = df_selected)

# below tests the residuals if they follow our assumptions:
autoplot(model)
```
NEW ADDITION: RESIDUALS VS. PREDICTORS. Look at plots and ensure residuals randomly scattered, no patterns (constant variance)
Modified from codealong6complete.rmd file.

```{r, fig.height=12, fig.width=12} 
X <- model.matrix(model)
head(X)
colnames(X)

#take residuals
rfull <- model$residuals

# create residuals vs fitted value plot
par(mfrow=c(3,3))
plot(rfull ~ model$fitted.values, xlab="Fitted Values", ylab="Residuals")

# plots for residuals vs predictors
for(i in 2:5){
plot(rfull ~ X[,i], xlab=colnames(X)[i], ylab="Residuals")
}

# QQ plot
qqnorm(rfull)
qqline(rfull)
```

```{r} 
# ignore this, cleaning and tidying data 

data_raw = read.csv("cybersecurity_attacks.csv")
data_cols <- data_raw %>% select(-Timestamp, -Source.IP.Address, -Destination.IP.Address, -User.Information, -Payload.Data)

# checking that there are only a select few attributes in the data :
all(data_raw$Firewall.Logs %in% c("Log Data", ""))
all(data_raw$IDS.IPS.Alerts %in% c("Alert Data", ""))
all(data_raw$Alerts.Warnings %in% c("Alert Triggered", ""))
all(data_raw$Malware.Indicators %in% c("IoC Detected", ""))

unique_entries <- unique(data_raw$Malware.Indicators)
print(unique_entries)
unique_entries <- unique(data_raw$Malware.Indicators)
print(unique_entries)
unique_entries <- unique(data_raw$Malware.Indicators)
print(unique_entries)
unique_entries <- unique(data_raw$Malware.Indicators)
print(unique_entries)
unique_entries <- unique(data_raw$Malware.Indicators)
print(unique_entries)
unique_entries <- unique(data_raw$Malware.Indicators)
print(unique_entries)
unique_entries <- unique(data_raw$Malware.Indicators)
print(unique_entries)


data_cols <- data_cols %>%
  mutate(across(c(Firewall.Logs), ~ ifelse(. == "Log Data", TRUE, FALSE)))

data_cols <- data_cols %>%
  mutate(across(c(IDS.IPS.Alerts), ~ ifelse(. == "Alert Data", TRUE, FALSE)))

data_cols <- data_cols %>%
  mutate(across(c(Alerts.Warnings), ~ ifelse(. == "Alert Triggered", TRUE, FALSE)))

data_cols <- data_cols %>%
  mutate(across(c(Malware.Indicators), ~ ifelse(. == "IoC Detected", TRUE, FALSE)))



```

